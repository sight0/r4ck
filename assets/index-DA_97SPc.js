import{j as e,r,a as Ft}from"./react-D94aisfQ.js";import{c as $t}from"./react-dom-DUnP3Ert.js";import{s as _e,A as At,T as Et,B as g,a as v,I as ce,d as Ot,P as we,b as te,L as Ke,c as Qe,e as Bt,D as me,f as ge,g as be,h as ye,i as F,j as Mt,k as et,l as Nt,m as zt,n as Lt,o as Ut,p as Ht,q as Gt,r as Jt,t as Yt,u as Vt,v as Je,w as le,x as Xt,S as Zt,y as Kt,z as tt,C as Be,E as Ae,F as st,G as Ce,H as Se,J as ke,M as E,K as Me,N as Ne,O as Qt,Q as es,R as ts,U as ue,V as ss,W as ns,X as rs,Y as Fe,Z as is,_ as as,$ as os,a0 as ls,a1 as cs,a2 as ds,a3 as ps,a4 as us,a5 as hs,a6 as xs,a7 as fs,a8 as nt,a9 as ms,aa as gs,ab as Ye,ac as bs,ad as ys,ae as js,af as vs,ag as Cs,ah as Ss,ai as ks,aj as ws}from"./@mui-C3aYDGLK.js";import{P as o}from"./prop-types-BTSn1Fai.js";import{E as Ds}from"./jspdf-Cg0WDYMU.js";import{F as Ps}from"./file-saver-BFCNC8hC.js";import"./jspdf-autotable-RrFAoSeZ.js";import"./@babel-COdrX_Wt.js";import"./scheduler-CzFDRTuY.js";import"./@emotion-8k4rIbXz.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-FDnFs_-n.js";import"./react-is-DcfIKM1A.js";import"./clsx-B-dksMZM.js";import"./react-transition-group-DRKz_gnz.js";import"./@popperjs-BQBsAJpH.js";import"./fflate-Cf-_J6lE.js";(function(){const C=document.createElement("link").relList;if(C&&C.supports&&C.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))u(m);new MutationObserver(m=>{for(const d of m)if(d.type==="childList")for(const $ of d.addedNodes)$.tagName==="LINK"&&$.rel==="modulepreload"&&u($)}).observe(document,{childList:!0,subtree:!0});function a(m){const d={};return m.integrity&&(d.integrity=m.integrity),m.referrerPolicy&&(d.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?d.credentials="include":m.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function u(m){if(m.ep)return;m.ep=!0;const d=a(m);fetch(m.href,d)}})();const qs=_e("img")({marginRight:"16px",width:"80px",height:"34px"}),rt=({children:t})=>e.jsx(At,{position:"static",children:e.jsxs(Et,{className:"app-bar",sx:{justifyContent:"space-between"},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(qs,{src:"/r4ck/logo.png",alt:"Logo"}),e.jsx(v,{variant:"h6",sx:{mr:2},children:"Design and Recommendation Tool"}),e.jsx(ce,{color:"inherit","aria-label":"GitHub repository",component:"a",href:"https://github.com/sight0/r4ck",target:"_blank",rel:"noopener noreferrer",children:e.jsx(Ot,{})})]}),e.jsx(g,{sx:{display:"flex",alignItems:"center"},children:t})]})});rt.propTypes={children:o.node};const it=[{id:1,name:"Router",type:"router",color:"#5D4037"},{id:2,name:"Switch",type:"switch",color:"#2E7D32"},{id:3,name:"Patch Panel",type:"patch_panel",color:"#6A1B9A"},{id:4,name:"Fiber Patch Panel",type:"fiber_patch_panel",color:"#AD1457"},{id:5,name:"Firewall",type:"firewall",color:"#C62828"},{id:6,name:"Server",type:"server",color:"#00838F"},{id:7,name:"UPS",type:"ups",color:"#FFA000"},{id:8,name:"Cable Manager",type:"cable_manager",color:"#EF6C00"},{id:9,name:"ONT",type:"ont",color:"#da6be6"}],at=({currentIdf:t})=>{const C=r.useCallback((a,u)=>{a.dataTransfer.setData("text/plain",JSON.stringify(u))},[]);return e.jsxs(we,{elevation:3,className:"sidebar",sx:{background:"#f5f5f5",height:"100%",padding:"20px",color:"#333"},children:[e.jsx(v,{variant:"h5",sx:{mb:3,fontWeight:"bold",textAlign:"center",color:"#1a1a1a"},children:"Components List"}),e.jsx(te,{placeholder:"Search components",fullWidth:!0,sx:{mb:3,"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#bdbdbd"},"&:hover fieldset":{borderColor:"#9e9e9e"},"&.Mui-focused fieldset":{borderColor:"#757575"}},"& .MuiInputBase-input":{color:"#272727",backgroundColor:"#dcdcdc"}}}),e.jsx(Ke,{children:it.map(a=>e.jsxs(Qe,{draggable:!0,onDragStart:u=>C(u,a),sx:{cursor:"move",mb:2,backgroundColor:"#ffffff",borderRadius:"10px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0,0,0,0.1)","&:hover":{backgroundColor:"#f0f0f0",transform:"translateY(-2px)",boxShadow:"0 4px 8px rgba(0,0,0,0.15)"},display:"flex",alignItems:"center",padding:"10px 15px",border:`2px solid ${a.color}`},children:[e.jsx(Bt,{sx:{mr:1,color:"#757575"}}),a.name]},a.id))})]})};at.propTypes={currentIdf:o.number.isRequired};const We=(t,C)=>{const a={};return t.forEach(u=>{u.type==="fiber_patch_panel"&&u.ports&&u.ports.forEach(m=>{if(m.cableSource&&m.cableSource.startsWith("IDF_")){const d=m.cableSource;a[d]||(a[d]=0),a[d]++}})}),a},Ve=t=>{switch(t){case"high":return"#ff4d4d";case"medium":return"#ffa500";case"low":return"#4caf50";default:return"#4a4a4a"}},_s=({issue:t})=>e.jsxs(g,{sx:{backgroundColor:t.isSatisfied?"#e8f5e9":"#fff3e0",borderRadius:2,p:2,mb:2,boxShadow:1,border:`1px solid ${t.isSatisfied?"#c8e6c9":"#ffe0b2"}`},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:1},children:[t.isSatisfied?e.jsx(Mt,{sx:{mr:1,color:"#4caf50"}}):e.jsx(et,{sx:{mr:1,color:Ve(t.severity)}}),e.jsx(v,{variant:"h6",color:t.isSatisfied?"#4caf50":Ve(t.severity),children:t.isSatisfied?"Requirement Satisfied":`${t.severity.charAt(0).toUpperCase()+t.severity.slice(1)} Priority Issue`})]}),e.jsx(v,{variant:"body1",sx:{mb:1,color:"#333"},children:t.message}),!t.isSatisfied&&e.jsxs(g,{sx:{display:"flex",alignItems:"center",mt:1,backgroundColor:"rgba(255, 152, 0, 0.1)",p:1,borderRadius:1},children:[e.jsx(Nt,{sx:{mr:1,color:"#ff9800"}}),e.jsxs(v,{variant:"body2",color:"#4a4a4a",children:[e.jsx("strong",{children:"Solution Hint:"})," ",t.solutionHint||"Review the requirement and adjust your rack design accordingly."]})]})]}),Rs=({open:t,onClose:C,issues:a})=>e.jsxs(me,{open:t,onClose:C,maxWidth:"md",fullWidth:!0,children:[e.jsx(ge,{sx:{backgroundColor:"#f5f5f5",borderBottom:"1px solid #e0e0e0"},children:e.jsx(v,{variant:"h5",component:"div",color:"#333",children:"Rack Design Issues and Requirements"})}),e.jsx(be,{sx:{maxHeight:"70vh",overflowY:"auto",backgroundColor:"#fafafa"},children:e.jsx(g,{sx:{mt:2},children:a.map((u,m)=>e.jsx(_s,{issue:u},m))})}),e.jsx(ye,{sx:{backgroundColor:"#f5f5f5",borderTop:"1px solid #e0e0e0"},children:e.jsx(F,{onClick:C,sx:{color:"#1976d2","&:hover":{backgroundColor:"rgba(25, 118, 210, 0.1)"}},children:"Close"})})]}),ot=({connections:t,currentIdf:C})=>{const[a,u]=r.useState(""),[m,d]=r.useState(!1),[$,S]=r.useState(""),z=r.useMemo(()=>t.flatMap(i=>{var n,h;return[(n=i.deviceA)==null?void 0:n.identifier,(h=i.deviceB)==null?void 0:h.identifier].filter(Boolean)}),[t]),B=t.filter(i=>i.deviceA.identifier.toLowerCase().includes(a.toLowerCase())||i.deviceB.identifier.toLowerCase().includes(a.toLowerCase())),M=()=>{const n=[["From Device","From Port","From Port Identifier","To Device","To Port","To Port Identifier"].join(","),...B.map(y=>[y.deviceA.deviceType+" "+y.deviceA.deviceSequence,y.deviceA.port,y.deviceA.identifier,y.deviceB.deviceType+" "+y.deviceB.deviceSequence,y.deviceB.port,y.deviceB.identifier].join(","))].join(`
`),h=new Blob([n],{type:"text/csv;charset=utf-8;"});Ps.saveAs(h,"patching_schedule.csv"),S("CSV exported successfully!"),d(!0)},w=()=>{const i=new Ds;i.setFontSize(18),i.text("Patching Schedule",14,22),i.setFontSize(11),i.setTextColor(100),i.autoTable({head:[["From Device","From Port","From Port Identifier","To Device","To Port","To Port Identifier"]],body:B.map(h=>[h.deviceA.deviceType+" "+h.deviceA.deviceSequence,h.deviceA.port,h.deviceA.identifier,h.deviceB.deviceType+" "+h.deviceB.deviceSequence,h.deviceB.port,h.deviceB.identifier]),startY:30,headStyles:{fillColor:[41,128,185],textColor:255},alternateRowStyles:{fillColor:[242,242,242]},margin:{top:30}});const n=`patching_schedule_IDF${C}.pdf`;i.save(n),S("PDF exported successfully!"),d(!0)},G=(i,n)=>{n!=="clickaway"&&d(!1)};return e.jsxs(we,{elevation:3,sx:{p:3,mb:4},children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(v,{variant:"h5",component:"div",sx:{fontWeight:"bold"},children:"Patching Schedule"}),e.jsxs(g,{children:[e.jsx(F,{variant:"contained",startIcon:e.jsx(zt,{}),onClick:M,sx:{mr:1,bgcolor:"#9f97eb","&:hover":{bgcolor:"#9f97eb"}},children:"Export CSV"}),e.jsx(F,{variant:"contained",startIcon:e.jsx(Lt,{}),onClick:w,sx:{bgcolor:"#9f97eb","&:hover":{bgcolor:"#9f97eb"}},children:"Export PDF"})]})]}),e.jsx(Ut,{freeSolo:!0,options:z,renderInput:i=>e.jsx(te,{...i,variant:"outlined",size:"small",placeholder:"Search identifiers...",InputProps:{...i.InputProps,startAdornment:e.jsx(Ht,{position:"start",children:e.jsx(Gt,{})})}}),onInputChange:(i,n)=>{u(n)},sx:{mb:2},renderOption:(i,n)=>r.createElement("li",{...i,key:n},n)}),e.jsx(Jt,{children:e.jsxs(Yt,{size:"small","aria-label":"patching schedule",children:[e.jsx(Vt,{children:e.jsxs(Je,{children:[e.jsx(le,{sx:{fontWeight:"bold"},children:"From Device"}),e.jsx(le,{sx:{fontWeight:"bold"},children:"From Port"}),e.jsx(le,{sx:{fontWeight:"bold"},children:"From Port Identifier"}),e.jsx(le,{sx:{fontWeight:"bold"},children:"To Device"}),e.jsx(le,{sx:{fontWeight:"bold"},children:"To Port"}),e.jsx(le,{sx:{fontWeight:"bold"},children:"To Port Identifier"})]})}),e.jsx(Xt,{children:B.map((i,n)=>e.jsxs(Je,{sx:{"&:nth-of-type(odd)":{backgroundColor:"action.hover"}},children:[e.jsxs(le,{children:[i.deviceA.deviceType," ",i.deviceA.deviceSequence]}),e.jsx(le,{children:i.deviceA.port}),e.jsx(le,{children:i.deviceA.identifier}),e.jsxs(le,{children:[i.deviceB.deviceType," ",i.deviceB.deviceSequence]}),e.jsx(le,{children:i.deviceB.port}),e.jsx(le,{children:i.deviceB.identifier})]},n))})]})}),B.length===0&&e.jsx(v,{variant:"body2",sx:{mt:2,textAlign:"center",fontStyle:"italic"},children:"No connections found matching your search criteria."}),e.jsx(Zt,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:m,autoHideDuration:3e3,onClose:G,message:$})]})};ot.propTypes={connections:o.arrayOf(o.shape({deviceA:o.shape({componentId:o.string.isRequired,deviceType:o.string.isRequired,deviceSequence:o.number.isRequired,port:o.string.isRequired}).isRequired,deviceB:o.shape({componentId:o.string.isRequired,deviceType:o.string.isRequired,deviceSequence:o.number.isRequired,port:o.string.isRequired}).isRequired})).isRequired,components:o.arrayOf(o.shape({id:o.string.isRequired,name:o.string.isRequired})).isRequired,currentIdf:o.number.isRequired};const lt=({component:t,rackWidth:C,onDelete:a,onEdit:u,onDragStart:m,isDragging:d,componentColors:$,isHighlighted:S,sequence:z})=>{const B=t.type==="cable_manager",M=B?20:t.units*20;return e.jsxs("g",{transform:`translate(${t.x}, ${t.y})`,children:[e.jsx("rect",{width:C-40,height:M,fill:d?"rgba(66, 165, 245, 0.5)":$[t.type]||$.other,stroke:S?"#000000":$[t.type]||$.other,strokeWidth:S?7:1,rx:"5",ry:"5"}),e.jsxs("text",{x:"25",y:M/2,fill:"white",fontSize:"12",dy:".35em",children:[e.jsx("tspan",{fontWeight:"bold",children:t.type==="fiber_patch_panel"?"Fiber PP":t.type.charAt(0).toUpperCase()+t.type.slice(1).replace("_"," ")}),!B&&e.jsx("tspan",{dx:"5",children:t.sequence}),!B&&e.jsxs("tspan",{dx:"5",fontStyle:"italic",children:["(",t.name.length>16&&t.units===1?t.name.substring(0,14)+"...":t.name,")"]})]}),e.jsx("foreignObject",{x:"0",y:"-4",width:"30",height:"30",children:e.jsx(ce,{onMouseDown:w=>m(w),size:"small",style:{cursor:"move"},children:e.jsx(Kt,{fontSize:"small"})})}),!B&&e.jsx("foreignObject",{x:C-100,y:"-4",width:"30",height:"30",children:e.jsx(ce,{onClick:()=>u(t),size:"small",children:e.jsx(tt,{fontSize:"small"})})}),e.jsx("foreignObject",{x:C-70,y:"-4",width:"30",height:"30",children:e.jsx(ce,{onClick:()=>a(t.id),size:"small",children:e.jsx(Be,{fontSize:"small"})})})]})};lt.propTypes={component:o.shape({id:o.string.isRequired,x:o.number.isRequired,y:o.number.isRequired,name:o.string.isRequired,sequence:o.number.isRequired,capacity:o.string.isRequired,units:o.number.isRequired,type:o.string.isRequired}).isRequired,rackWidth:o.number.isRequired,onDelete:o.func.isRequired,onEdit:o.func.isRequired,onDragStart:o.func.isRequired,isDragging:o.bool,componentColors:o.object.isRequired,isHighlighted:o.bool,sequence:o.number};const Is={access_point:"AP",ip_phone:"IP",end_user_device:"EU",switch:"SW",router:"RT",server:"SR",firewall:"FW",patch_panel:"PP",fiber_patch_panel:"FP",ups:"UP",cable_manager:"CM",other:"OT"},ve=(t,C,a,u)=>{let m=Ws(t)?"A":"B",d=Is[t]||"OT";const $=C.toString().padStart(2,"0"),S=a.toString().padStart(2,"0"),z=u.toString().padStart(3,"0");return t==="MDF"?(m="A",d="DF"):t==="IDF"&&(m="B",d="DF"),`${m}${d}-${$}-${S}-${z}`},Ws=t=>["access_point","ip_phone","end_user_device"].includes(t);let Ts=0;const $e=()=>`${Date.now()}-${Math.random().toString(36).substr(2,9)}-${Ts++}`,ct=({open:t,onClose:C,ports:a,numIdfs:u,idf:m,onPortChange:d,component:$})=>{const S=$.type,[z,B]=r.useState(a);r.useEffect(()=>{B(a)},[a]);const M=()=>`Identifier Structure:
        A/B: End-user device / Infrastructure device
        XX: Device type code
        YY: IDF number
        ZZ: Device sequence
        NNN: Port number`,w=(i,n)=>{const h=[...z];h[i].cableSource=n,h[i].identifier=ve(n,m,$.sequence,i+1),B(h),d(i,"cableSource",n),d(i,"identifier",h[i].identifier)},G=()=>S==="patch_panel"?[e.jsx(E,{value:"end_user_device",children:"End User Device"},"end_user_device"),e.jsx(E,{value:"ip_phone",children:"IP Phone"},"ip_phone"),e.jsx(E,{value:"access_point",children:"Access Point"},"access_point")]:S==="fiber_patch_panel"?[...[...Array(u)].map((i,n)=>e.jsx(E,{value:`IDF_${n+1}`,disabled:n+1===m,children:n+1===u?"MDF":`IDF ${n+1}`},`IDF_${n+1}`))]:[];return e.jsxs(me,{open:t,onClose:()=>C(z),maxWidth:"lg",fullWidth:!0,children:[e.jsxs(ge,{children:["Configure Ports for ",S,e.jsx(Ae,{title:M(),arrow:!0,children:e.jsx(ce,{size:"small",sx:{ml:1},children:e.jsx(st,{})})})]}),e.jsx(be,{children:e.jsx(g,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:2},children:z.map((i,n)=>e.jsxs(g,{sx:{border:"1px solid #ccc",padding:1,borderRadius:1},children:[e.jsx(te,{label:`Port ${n+1}`,value:i.label||"",onChange:h=>{const y=[...z];y[n].label=h.target.value,B(y),d(n,"label",h.target.value)},fullWidth:!0,margin:"dense"}),e.jsxs(Ce,{fullWidth:!0,margin:"dense",children:[e.jsx(Se,{children:"Device"}),e.jsxs(ke,{value:i.cableSource||"",onChange:h=>w(n,h.target.value),children:[e.jsx(E,{value:"",children:e.jsx("em",{children:"None"})}),G()]})]}),e.jsx(te,{label:"Identifier",value:i.identifier||"",InputProps:{readOnly:!0},fullWidth:!0,margin:"dense"}),i.connectedTo&&e.jsxs(v,{variant:"caption",display:"block",sx:{mt:1},children:["Connected to: ",i.connectedTo]})]},n))})}),e.jsx(ye,{children:e.jsx(F,{onClick:()=>C(z),children:"Close"})})]})};ct.propTypes={open:o.bool.isRequired,onClose:o.func.isRequired,ports:o.array.isRequired,numIdfs:o.number.isRequired,idf:o.number.isRequired,onPortChange:o.func.isRequired,component:o.shape({type:o.string.isRequired,id:o.string.isRequired,sequence:o.number.isRequired}).isRequired};const dt=({open:t,onClose:C,component:a,numIdfs:u,idfData:m,currentIdf:d,deviceSequence:$=0})=>{const[S,z]=r.useState(null),[B,M]=r.useState(!1);r.useEffect(()=>{if(a){const n=(h,y,O)=>Array.from({length:h},(N,V)=>{const X=`Port ${V+1}`,J=ve(y,d,O,V+1);return{label:X,cableSource:"",connectedTo:"",identifier:J}});z({...a,ports:a.ports||n(a.capacity,a.type,a.sequence||$),sequence:a.sequence||$,deviceSequence:a.sequence||$})}},[a,d,$]);const w=n=>{const{name:h,value:y}=n.target;z(O=>{const N={...O,[h]:y};if(h==="capacity"||h==="type"){const V=h==="capacity"?parseInt(y,10):O.capacity,X=h==="type"?y:O.type,J=se=>Array.from({length:se},(ne,Z)=>{const ie=`Port ${Z+1}`,ae=ve(X,d,N.sequence,Z+1);return{label:ie,cableSource:"",connectedTo:"",type:X==="fiber_patch_panel"?"fiber":"copper",identifier:ae}});N.ports=J(V)}return N})},G=()=>{C({...S,deviceSequence:S.sequence})},i=(n,h,y)=>{z(O=>{const N=[...O.ports];return N[n]={...N[n],[h]:y},O.type==="patch_panel"?["end_user_device","ip_phone","access_point"].includes(y)?N[n].connectedTo=y:N[n].connectedTo="":O.type==="fiber_patch_panel"&&(y.startsWith("IDF_")||y==="MDF"?N[n].connectedTo=y:N[n].connectedTo=""),{...O,ports:N}})};return S?e.jsxs(e.Fragment,{children:[e.jsxs(me,{open:t,onClose:()=>C(null),maxWidth:"md",fullWidth:!0,children:[e.jsxs(ge,{children:["Edit Component: ",S.name]}),e.jsx(be,{children:e.jsxs(g,{children:[e.jsx(te,{name:"name",label:"Name",value:S.name,onChange:w,fullWidth:!0,margin:"normal"}),S.type==="switch"||S.type==="patch_panel"||S.type==="fiber_patch_panel"||S.type==="ont"?e.jsxs(Ce,{fullWidth:!0,margin:"normal",children:[e.jsx(Se,{children:"Capacity/Ports"}),e.jsx(ke,{name:"capacity",value:S.capacity,onChange:w,children:S.type==="switch"?["8","24","48"].map(n=>e.jsx(E,{value:n,children:n},n)):S.type==="fiber_patch_panel"?["12","24"].map(n=>e.jsx(E,{value:n,children:n},n)):S.type==="ont"?["1","2"].map(n=>e.jsx(E,{value:n,children:n},n)):["24"].map(n=>e.jsx(E,{value:n,children:n},n))})]}):e.jsx(te,{name:"capacity",label:"Capacity/Ports",value:S.capacity,onChange:w,fullWidth:!0,margin:"normal"}),e.jsx(te,{name:"units",label:"Units (U)",type:"number",value:S.units,onChange:w,fullWidth:!0,margin:"normal"}),e.jsxs(Ce,{fullWidth:!0,margin:"normal",children:[e.jsx(Se,{children:"Type"}),e.jsxs(ke,{name:"type",value:S.type,onChange:w,children:[e.jsx(E,{value:"router",children:"Router"}),e.jsx(E,{value:"switch",children:"Switch"}),e.jsx(E,{value:"fiber_switch",children:"Fiber Switch"}),e.jsx(E,{value:"patch_panel",children:"Patch Panel"}),e.jsx(E,{value:"fiber_patch_panel",children:"Fiber Patch Panel"}),e.jsx(E,{value:"firewall",children:"Firewall"}),e.jsx(E,{value:"server",children:"Server"}),e.jsx(E,{value:"ups",children:"UPS"}),e.jsx(E,{value:"other",children:"Other"})]})]}),(S.type==="patch_panel"||S.type==="fiber_patch_panel")&&e.jsx(F,{onClick:()=>M(!0),variant:"outlined",sx:{mt:2},children:"Configure Ports"})]})}),e.jsxs(ye,{children:[e.jsx(F,{onClick:()=>C(null),children:"Cancel"}),e.jsx(F,{onClick:G,color:"primary",children:"Save"})]})]}),(S.type==="patch_panel"||S.type==="fiber_patch_panel")&&e.jsx(ct,{open:B,onClose:()=>M(!1),ports:S.ports,numIdfs:u,idf:d,onPortChange:i,component:S})]}):null};dt.propTypes={open:o.bool.isRequired,onClose:o.func.isRequired,component:o.object,numIdfs:o.number.isRequired,idfData:o.object.isRequired,currentIdf:o.number.isRequired,deviceSequence:o.number};const pt=({open:t,onClose:C,components:a,currentIdf:u,onConnectionCreate:m,onConnectionUpdate:d,onConnectionDelete:$,existingConnections:S})=>{const z=Me(),[B,M]=r.useState(0),[w,G]=r.useState({firstComponent:"",firstPort:"",secondComponent:"",secondPort:"",type:"",speed:"",notes:"",firstDeviceSequence:"",secondDeviceSequence:""}),[i,n]=r.useState([]),[h,y]=r.useState(!1),[O,N]=r.useState(null),V=[{label:"Select Devices",fields:["firstComponent","secondComponent"]},{label:"Select Ports",fields:["firstPort","secondPort"]},{label:"Connection Details",fields:["type","speed","notes"]},{label:"Review",fields:[]}];r.useEffect(()=>{w.firstComponent&&n(a.filter(j=>j.id!==w.firstComponent))},[w.firstComponent,a]);const X=()=>M(j=>j+1),J=()=>M(j=>j-1),se=()=>{y(!0),G({firstComponent:"",firstPort:"",secondComponent:"",secondPort:"",type:"",speed:"",notes:""}),M(0)},ne=()=>{const j=(Q,xe)=>{const oe=a.find(T=>T.id===Q),pe=oe.ports.find(T=>T.label===xe);return{componentId:Q,port:xe,identifier:pe.identifier,deviceType:oe.type,deviceSequence:oe.sequence}},K={id:O?O.id:$e(),deviceA:j(w.firstComponent,w.firstPort),deviceB:j(w.secondComponent,w.secondPort),idf:u,type:w.type,speed:w.speed,notes:w.notes};O?d(K):m(K),y(!1),N(null),G({firstComponent:"",firstPort:"",secondComponent:"",secondPort:"",type:"",speed:"",notes:""})},Z=j=>{N(j),G({firstComponent:j.deviceA.componentId,firstPort:j.deviceA.port,secondComponent:j.deviceB.componentId,secondPort:j.deviceB.port,type:j.type||"",speed:j.speed||"",notes:j.notes||"",firstDeviceSequence:j.deviceA.deviceSequence,secondDeviceSequence:j.deviceB.deviceSequence}),y(!0),M(0)},ie=j=>$(j),ae=(j,K)=>{G(Q=>({...Q,[j]:K}))},H=()=>S.length===0?e.jsx(v,{variant:"body1",sx:{textAlign:"center",py:2},children:"No connections yet."}):e.jsx(ue,{container:!0,spacing:2,children:S.map((j,K)=>e.jsx(ue,{item:!0,xs:12,sm:6,md:4,children:e.jsx(ss,{sx:{height:"100%"},children:e.jsxs(ns,{children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(v,{variant:"h6",children:["Connection ",K+1]}),e.jsxs(g,{children:[e.jsx(ce,{size:"small",onClick:()=>Z(j),children:e.jsx(tt,{fontSize:"small"})}),e.jsx(ce,{size:"small",onClick:()=>ie(j.id),children:e.jsx(Be,{fontSize:"small"})})]})]}),e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsxs(v,{variant:"body2",sx:{fontWeight:"medium"},children:[j.deviceA.deviceType," ",j.deviceA.deviceSequence," (",he(j.deviceA.componentId),")"]}),e.jsx(rs,{sx:{mx:1}}),e.jsxs(v,{variant:"body2",sx:{fontWeight:"medium"},children:[j.deviceB.deviceType," ",j.deviceB.deviceSequence," (",he(j.deviceB.componentId),")"]})]}),e.jsxs(v,{variant:"body2",color:"text.secondary",children:[j.deviceA.port," (",j.deviceA.identifier,") → ",j.deviceB.port," (",j.deviceB.identifier||"N/A",")"]}),e.jsxs(g,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:.5},children:[e.jsx(Fe,{label:`IDF ${j.idf}`,size:"small"}),e.jsx(Fe,{label:`Type: ${j.type||"N/A"}`,size:"small"}),e.jsx(Fe,{label:`Speed: ${j.speed||"N/A"}`,size:"small"}),j.notes&&e.jsx(Ae,{title:j.notes,children:e.jsx(Fe,{icon:e.jsx(st,{}),label:"Notes",size:"small"})})]})]})})},j.id))}),he=j=>{const K=a.find(Q=>Q.id===j);return K?K.name:"Unknown"},de=j=>{var Q,xe,oe,pe,T,k;const K=V[j];return e.jsxs(g,{sx:{mt:2},children:[K.fields.map(p=>{switch(p){case"firstComponent":case"secondComponent":return e.jsxs(Ce,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Se,{children:p==="firstComponent"?"First Device":"Second Device"}),e.jsx(ke,{value:w[p],onChange:I=>ae(p,I.target.value),children:(p==="firstComponent"?a:i).map(I=>e.jsxs(E,{value:I.id,children:[I.name," (",I.type," ",I.sequence,")"]},I.id))})]},p);case"firstPort":case"secondPort":const W=p==="firstPort"?w.firstComponent:w.secondComponent,_=a.find(I=>I.id===W),re=(_==null?void 0:_.ports)||[],fe=new Set(S.flatMap(I=>[`${I.deviceA.componentId}-${I.deviceA.port}`,`${I.deviceB.componentId}-${I.deviceB.port}`])),De=re.filter(I=>!fe.has(`${_.id}-${I.label}`));return e.jsxs(Ce,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Se,{children:p==="firstPort"?"First Port":"Second Port"}),e.jsx(ke,{value:w[p],onChange:I=>ae(p,I.target.value),children:De.map((I,je)=>e.jsxs(E,{value:I.label,children:[I.label," - ",I.identifier," (",_.type," ",_.sequence,")"]},je))})]},p);case"type":return e.jsxs(Ce,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Se,{children:"Connection Type"}),e.jsxs(ke,{value:w.type,onChange:I=>ae("type",I.target.value),children:[e.jsx(E,{value:"copper",children:"Copper"}),e.jsx(E,{value:"fiber",children:"Fiber"}),e.jsx(E,{value:"wireless",children:"Wireless"})]})]},p);case"speed":return e.jsxs(Ce,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Se,{children:"Connection Speed"}),e.jsxs(ke,{value:w.speed,onChange:I=>ae("speed",I.target.value),children:[e.jsx(E,{value:"10Mbps",children:"10 Mbps"}),e.jsx(E,{value:"100Mbps",children:"100 Mbps"}),e.jsx(E,{value:"1Gbps",children:"1 Gbps"}),e.jsx(E,{value:"10Gbps",children:"10 Gbps"})]})]},p);case"notes":return e.jsx(te,{fullWidth:!0,label:"Notes",multiline:!0,rows:4,value:w.notes,onChange:I=>ae("notes",I.target.value),sx:{mb:2}},p);default:return null}}),j===V.length-1&&e.jsxs(we,{elevation:3,sx:{p:2,mt:2},children:[e.jsx(v,{variant:"h6",gutterBottom:!0,children:"Connection Summary"}),e.jsxs(v,{children:["First Device: ",(Q=a.find(p=>p.id===w.firstComponent))==null?void 0:Q.name," (",(xe=a.find(p=>p.id===w.firstComponent))==null?void 0:xe.type," ",(oe=a.find(p=>p.id===w.firstComponent))==null?void 0:oe.sequence,")"]}),e.jsxs(v,{children:["First Port: ",w.firstPort]}),e.jsxs(v,{children:["Second Device: ",(pe=a.find(p=>p.id===w.secondComponent))==null?void 0:pe.name," (",(T=a.find(p=>p.id===w.secondComponent))==null?void 0:T.type," ",(k=a.find(p=>p.id===w.secondComponent))==null?void 0:k.sequence,")"]}),e.jsxs(v,{children:["Second Port: ",w.secondPort]}),e.jsxs(v,{children:["Connection Type: ",w.type]}),e.jsxs(v,{children:["Connection Speed: ",w.speed]}),e.jsxs(v,{children:["Notes: ",w.notes]})]})]})};return e.jsxs(me,{open:t,onClose:C,maxWidth:"lg",fullWidth:!0,children:[e.jsx(ge,{sx:{borderBottom:`1px solid ${z.palette.divider}`,pb:2},children:"Connection Wizard"}),e.jsx(be,{sx:{mt:2,minHeight:"60vh"},children:h?e.jsxs(g,{children:[e.jsx(Qt,{activeStep:B,alternativeLabel:!0,children:V.map(({label:j})=>e.jsx(es,{children:e.jsx(ts,{children:j})},j))}),de(B)]}):e.jsxs(g,{children:[e.jsx(v,{variant:"h6",gutterBottom:!0,children:"Existing Connections"}),H(),e.jsx(F,{variant:"contained",startIcon:e.jsx(Ne,{}),onClick:se,sx:{mt:2,backgroundColor:"#FFD700",color:"#000","&:hover":{backgroundColor:"#FFC700"}},children:"Add New Connection"})]})}),e.jsxs(ye,{sx:{borderTop:"1px solid #333",pt:2},children:[e.jsx(F,{onClick:C,sx:{color:"#fff"},children:"Close"}),h&&e.jsxs(e.Fragment,{children:[e.jsx(F,{disabled:B===0,onClick:J,sx:{color:"#fff"},children:"Back"}),B===V.length-1?e.jsx(F,{onClick:ne,sx:{backgroundColor:"#FFD700",color:"#000","&:hover":{backgroundColor:"#FFC700"}},children:"Finish"}):e.jsx(F,{onClick:X,sx:{backgroundColor:"#FFD700",color:"#000","&:hover":{backgroundColor:"#FFC700"}},children:"Next"})]})]})]})};pt.propTypes={open:o.bool.isRequired,onClose:o.func.isRequired,components:o.array.isRequired,currentIdf:o.number.isRequired,onConnectionCreate:o.func.isRequired,onConnectionDelete:o.func.isRequired,existingConnections:o.array.isRequired};const Xe=Object.fromEntries(it.map(t=>[t.type,t.color])),Fs=_e(F)(({theme:t})=>({backgroundColor:t.palette.success.main,"&:hover":{backgroundColor:t.palette.success.dark},"&.Mui-disabled":{backgroundColor:t.palette.action.disabledBackground}})),$s=_e(g)({position:"relative","& .rack-units":{position:"absolute",left:"5px",width:"25px",textAlign:"right",fontSize:"10px",color:"#999"}}),As=_e(F,{shouldForwardProp:t=>t!=="isActive"})(({theme:t,isActive:C})=>({margin:t.spacing(1),minWidth:"80px",backgroundColor:C?t.palette.primary.dark:t.palette.primary.main,color:t.palette.primary.contrastText,"&:hover":{backgroundColor:t.palette.primary.dark}})),Es=_e(F)(({theme:t})=>({margin:t.spacing(1),minWidth:"100px",backgroundColor:t.palette.secondary.main,color:t.palette.secondary.contrastText,"&:hover":{backgroundColor:t.palette.secondary.dark}}));_e("div")(({theme:t})=>({width:"2px",backgroundColor:t.palette.grey[400],margin:"0 auto"}));const ut=({currentIdf:t,setCurrentIdf:C,numIdfs:a,idfData:u,interIdfConnections:m,onUpdateInterIdfConnections:d,onPortChange:$,connectionsPerIdf:S,onAddConnection:z,onUpdateConnection:B,onDeleteConnection:M,rackDesign:w,onSaveRackDesign:G,allComponents:i,setAllComponents:n})=>{var Ge;const[h,y]=r.useState({});r.useState(!1);const[O,N]=r.useState(0),[V,X]=r.useState(!1),[J,se]=r.useState(null),[ne,Z]=r.useState(null),[ie,ae]=r.useState(""),[H,he]=r.useState(null),[de,j]=r.useState(null),[K,Q]=r.useState(!1),[xe,oe]=r.useState(0),[pe,T]=r.useState(null),[k,p]=r.useState(!1),[W,_]=r.useState(!1),[re,fe]=r.useState(!1),[De,I]=r.useState(!1),je=r.useRef(null),Y=Me(),L=r.useMemo(()=>i[t]||[],[i,t]);r.useEffect(()=>{var l;const c=(((l=u[t])==null?void 0:l.devices)||[]).reduce((x,b)=>x+b.count,0);N(c)},[t,u]),r.useEffect(()=>{console.log(S)},[]);const mt=()=>{var q,D;if(L.length>0){alert("Auto placement is only available when the IDF is empty. Please clear the IDF first.");return}const s={type:"fiber_patch_panel",name:"FPP",capacity:"12",units:1};let c;t===a?c=[{type:"ont",name:"ONT",capacity:"1",units:1},{type:"cable_manager",name:"Cable Manager 1",capacity:"1",units:1},{type:"patch_panel",name:"PP",capacity:"24",units:1},{type:"patch_panel",name:"PP",capacity:"24",units:1},{type:"cable_manager",name:"Cable Manager 2",capacity:"1",units:1},{type:"switch",name:"C9200-48T",capacity:"48",units:1}]:c=[{type:"cable_manager",name:"Cable Manager 1",capacity:"1",units:1},{type:"patch_panel",name:"PP",capacity:"24",units:1},{type:"patch_panel",name:"PP",capacity:"24",units:1},{type:"cable_manager",name:"Cable Manager 2",capacity:"1",units:1},{type:"switch",name:"C9200-48T",capacity:"48",units:1}];const l=c.reduce((U,ee)=>U+ee.units,0)+s.units,x=Math.ceil(O/48),b=l+(l-s.units)*(x-1);if(b>((q=u[t])==null?void 0:q.rackSize)){alert(`Warning: The current rack size (${(D=u[t])==null?void 0:D.rackSize}U) is insufficient for the required components (${b}U). Please increase the rack size in the initial setup or reduce the number of devices.`);return}let P=0;const A={},R=[],f=ze(s,P,A);R.push(f),P+=s.units*20;for(let U=0;U<x;U++)c.forEach(ee=>{const qe=ze(ee,P,A);R.push(qe),P+=ee.units*20});n(U=>({...U,[t]:R})),y(U=>({...U,...A}))},ze=(s,c,l)=>{l[s.type]||(l[s.type]=0),l[s.type]++;const x=l[s.type];return{...s,id:$e(),x:30,y:c,sequence:x,name:`${s.name}${x}`,ports:Array.from({length:parseInt(s.capacity)},(b,P)=>({label:`Port ${P+1}`,cableSource:"",connectedTo:"",type:s.type==="fiber_patch_panel"?"fiber":"copper",identifier:ve(s.type,t,x,P+1)}))}},gt=()=>{let s=L.filter(f=>f.type==="fiber_patch_panel"),c=L.filter(f=>f.type==="patch_panel").sort((f,q)=>q.ports.length-f.ports.length),l=L.filter(f=>f.type==="switch").sort((f,q)=>q.ports.length-f.ports.length),x=L.filter(f=>f.type==="ont");if(l.length===0){alert("Auto wiring requires at least one switch.");return}let b=[],P=new Set;const A=f=>P.has(f),R=(f,q)=>{const D={id:$e(),deviceA:{componentId:f.id,port:f.port.label,identifier:f.port.identifier,deviceType:f.type,deviceSequence:f.sequence},deviceB:{componentId:q.id,port:q.port.label,identifier:q.port.identifier,deviceType:q.type,deviceSequence:q.sequence},idf:t,type:f.type==="fiber_patch_panel"||q.type==="fiber_patch_panel"?"fiber":"copper",speed:f.type==="fiber_patch_panel"||q.type==="fiber_patch_panel"?"10Gbps":"1Gbps",notes:`Auto-generated ${f.type} to ${q.type} connection`};b.push(D),P.add(f.port.identifier),P.add(q.port.identifier)};s.forEach(f=>{let q=l[0],D=0;f.ports.forEach(U=>{if(D<q.ports.length){const ee=q.ports[D];!A(ee.identifier)&&!A(U.identifier)&&(R({id:f.id,port:U,type:"fiber_patch_panel",sequence:f.sequence},{id:q.id,port:ee,type:"switch",sequence:q.sequence}),D++)}})}),t===a&&x.forEach(f=>{let q=l[0],D=q.ports.findIndex(U=>!A(U.identifier));f.ports.forEach(U=>{if(D<q.ports.length){const ee=q.ports[D];!A(ee.identifier)&&!A(U.identifier)&&(R({id:f.id,port:U,type:"ont",sequence:f.sequence},{id:q.id,port:ee,type:"switch",sequence:q.sequence}),D++)}})}),l.forEach(f=>{let q=f.ports.findIndex(D=>!A(D.identifier));c.forEach(D=>{D.ports.forEach(U=>{if(q<f.ports.length){const ee=f.ports[q];!A(ee.identifier)&&!A(U.identifier)&&(R({id:D.id,port:U,type:"patch_panel",sequence:D.sequence},{id:f.id,port:ee,type:"switch",sequence:f.sequence}),q++)}})})}),b.forEach(f=>{z(f)}),b.length>0?alert(`Successfully created ${b.length} connections! > View Patching Schedule`):alert("No new connections could be created. All ports might be already connected.")},bt=()=>{var q;const s=L.filter(D=>D.type==="patch_panel"),c=L.filter(D=>D.type==="fiber_patch_panel"),l=((q=u[t])==null?void 0:q.devices)||[];if(s.length===0){alert("Auto port wiring requires at least one patch panel.");return}if(c.length===0){alert("Auto port wiring requires at least one fiber patch panel.");return}let x=l.reduce((D,U)=>D+U.count,0),b=s.reduce((D,U)=>D+U.ports.length,0);if(b<x){alert(`Not enough patch panel ports (${b}) to satisfy device requirements (${x}).`);return}let P=[...L],A={...m};const R=P.find(D=>D.type==="fiber_patch_panel");if(t===a){A[t]={};for(let D=1;D<a;D++)D<=R.ports.length&&(R.ports[D-1].cableSource=`IDF_${D}`,R.ports[D-1].identifier=ve("IDF",t,R.sequence,D),A[t][`IDF_${D}`]=1)}else R.ports[0].cableSource=`IDF_${a}`,R.ports[0].identifier=ve("MDF",t,R.sequence,1),A[t]={MDF:1};let f=0;l.forEach(D=>{for(let U=0;U<D.count;U++)for(;f<s.length*s[0].ports.length;){const ee=Math.floor(f/s[0].ports.length),qe=f%s[0].ports.length,Ie=P.find(Tt=>Tt.id===s[ee].id);if(Ie&&!Ie.ports[qe].cableSource){Ie.ports[qe].cableSource=D.type,Ie.ports[qe].identifier=ve(D.type,t,Ie.sequence,qe+1);break}f++}}),n(D=>({...D,[t]:P})),d(A),alert("Auto port wiring completed successfully.")},Ee=s=>{const c=L.filter(x=>x.type===s).map(x=>x.sequence).sort((x,b)=>x-b);let l=1;for(const x of c){if(x!==l)return l;l++}return l},yt=s=>{z(s),n(c=>{const l=c[t].map(x=>x.id===s.deviceA.componentId||x.id===s.deviceB.componentId?{...x,ports:x.ports.map(b=>x.id===s.deviceA.componentId&&b.label===s.deviceA.port||x.id===s.deviceB.componentId&&b.label===s.deviceB.port?{...b,connectedTo:x.id===s.deviceA.componentId?s.deviceB.componentId:s.deviceA.componentId,connectedPort:x.id===s.deviceA.componentId?s.deviceB.port:s.deviceA.port}:b)}:x);return{...c,[t]:l}})},jt=s=>{M(s),n(c=>{const l=S[t].find(x=>x.id===s);if(l){const x=c[t].map(b=>b.id===l.deviceA.componentId||b.id===l.deviceB.componentId?{...b,ports:b.ports.map(P=>P.label===l.deviceA.port&&b.id===l.deviceA.componentId||P.label===l.deviceB.port&&b.id===l.deviceB.componentId?{...P,connectedTo:"",connectedPort:"",connectionType:"",connectedDeviceType:""}:P)}:b);return{...c,[t]:x}}return c})},Te=((Ge=u[t])==null?void 0:Ge.rackSize)||42,Oe=Te*20,Pe=298;Y.palette.secondary.main;const vt=()=>{if(confirm("Are you sure you want to clear this IDF? This action cannot be undone.")){n(c=>{const l={...c};return delete l[t],l}),M(t);const s=We([]);d({...m,[t]:s})}},Le=s=>{T(s)};r.useEffect(()=>{var l;const s=L.filter(x=>x.type==="patch_panel").reduce((x,b)=>x+parseInt(b.capacity),0),c=((l=u[t])==null?void 0:l.ports)||0;oe(Math.min(s,c)),ae("Recommendation: Add a 48-port switch for optimal performance.")},[L,t,u]),r.useEffect(()=>{const s={};Object.values(i).forEach(c=>{c.forEach(l=>{s[l.type]||(s[l.type]=0),s[l.type]=Math.max(s[l.type],l.sequence||0)})}),y(s)},[i]);const Ct=r.useCallback(s=>{s.preventDefault();const c=je.current.getBoundingClientRect(),l=s.clientY-c.top,x=s.dataTransfer.getData("text/plain"),b=JSON.parse(x),P=Math.floor(l/20)*20,A={...b,x:30,y:P,id:$e()};if(b.type==="cable_manager"){const R=Ee(b.type);A.name=`Cable Manager ${R}`,A.capacity="1",A.units=1,A.sequence=R,n(f=>({...f,[t]:[...f[t]||[],A]})),y(f=>({...f,[b.type]:R}))}else se(A),X(!0);j(null)},[t,Ee]),St=r.useCallback(s=>{s.preventDefault();const c=je.current.getBoundingClientRect(),l=s.clientY-c.top,x=Math.floor(l/20)*20;j({y:x,height:20})},[]),kt=(s,c,l)=>{if(s&&c&&l){const x=Ee(J.type),b={...J,name:s,capacity:c,units:parseInt(l),sequence:x},P=parseInt(c);if(b.ports=Array.from({length:P},(R,f)=>({label:`Port ${f+1}`,cableSource:"",connectedTo:"",type:b.type==="fiber_patch_panel"?"fiber":"copper",identifier:ve(b.type,t,x,f+1)})),b.y+b.units*20>Oe){alert("The component doesn't fit within the rack. Please adjust the size or position.");return}L.some(R=>b.y<R.y+R.units*20&&b.y+b.units*20>R.y)?alert("This position overlaps with an existing component. Please choose a different position."):(n(R=>{const f=[...R[t]||[],b];return{...R,[t]:f}}),X(!1),se(null))}else X(!1),se(null)},wt=()=>{t>1&&C(t-1)},Ue=r.useCallback(()=>{localStorage.setItem("rackDesigns",JSON.stringify(i))},[i]),He=r.useCallback(()=>{const s=localStorage.getItem("rackDesigns");s&&n(JSON.parse(s))},[]);r.useEffect(()=>{He()},[He]),r.useEffect(()=>{Ue()},[i,Ue]);const Dt=()=>{t<=a&&C(t+1)},Pt=r.useCallback((s,c)=>{he(c)},[]),qt=r.useCallback(s=>{if(!H)return;const c=je.current.getBoundingClientRect(),l=s.clientY-c.top,x=Math.floor(l/20)*20;he(b=>({...b,y:x}))},[H]),_t=r.useCallback(()=>{if(!H)return;L.some(c=>c.id!==H.id&&H.y<c.y+c.units*20&&H.y+H.units*20>c.y)||n(c=>({...c,[t]:c[t].map(l=>l.id===H.id?H:l)})),he(null)},[H,L,t]),Rt=s=>{if(window.confirm("Are you sure you want to delete this component? This will also delete any connections made with this component.")){n(x=>{const b=x[t].filter(P=>P.id!==s);return{...x,[t]:b}});const l=We(i[t].filter(x=>x.id!==s));d({...m,[t]:l})}},It=s=>{Z({...s,deviceSequence:s.sequence}),Q(!0)},Wt=s=>{s&&(L.some(l=>l.id!==s.id&&s.y<l.y+l.units*20&&s.y+s.units*20>l.y)?alert("The updated component overlaps with existing components. Please adjust the size or position."):n(l=>{const x=l[t].map(P=>P.id===s.id?{...s,sequence:P.sequence}:P),b=We(x);return d({...m,[t]:b}),{...l,[t]:x}})),Q(!1),Z(null)},Re=()=>{var b;let s=[];const c=((b=u[t])==null?void 0:b.devices)||[],l=L.filter(P=>P.type==="patch_panel").flatMap(P=>P.ports||[]);c.forEach(P=>{const{type:A,count:R}=P,f=l.filter(D=>D.cableSource===A).length,q=A.split("_").map(D=>D.charAt(0).toUpperCase()+D.slice(1)).join(" ");s.push({message:`Allocate patch panel ports for ${A}: This IDF requires ${R} dedicated patch panel port(s) for ${q}(s).`,isSatisfied:f>=R,severity:"high",solutionHint:f>=R?`All required ports are allocated for ${A}.`:`Configure ${R-f} more port(s) for ${A}.`})});const x=L.filter(P=>P.type==="fiber_patch_panel").flatMap(P=>P.ports||[]);return Object.entries(m).forEach(([P,A])=>{if(P!==t.toString()&&A){const R=A[`IDF_${t}`]||0;if(R>0){const f=parseInt(P)===a?"MDF":`IDF ${P}`,q=x.filter(D=>D.cableSource===(parseInt(P)===a+1?"MDF":`IDF_${P}`)).length;s.push({message:`Allocate patch panel ports for incoming connections from ${f}: This IDF needs to implement ${R} dedicated fiber patch panel port(s) to receive connections from ${f}.`,isSatisfied:q>=R,severity:"high",solutionHint:q>=R?`All required ports are allocated for incoming connections from ${f}.`:`Configure ${R-q} more port(s) for receiving connections from ${f}.`})}}}),s};return e.jsxs(g,{className:"rack-visualization-container",children:[e.jsxs(g,{sx:{mb:2},children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(v,{variant:"h5",sx:{fontWeight:"bold",color:"text.primary"},children:[t===a?"MDF":`IDF ${t}`," Rack Design"]}),e.jsxs(g,{children:[e.jsx(ce,{onClick:wt,disabled:t===1,children:e.jsx(is,{})}),e.jsx(ce,{onClick:Dt,children:e.jsx(as,{})})]})]}),e.jsxs(g,{sx:{display:"flex",flexDirection:"column",width:"100%",gap:2},children:[e.jsx(we,{elevation:3,sx:{p:2,backgroundColor:Y.palette.background.paper},children:e.jsx(ue,{container:!0,spacing:2,children:t===a?e.jsxs(e.Fragment,{children:[e.jsx(ue,{item:!0,xs:4,children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:1,border:`1px solid ${Y.palette.divider}`,borderRadius:1,backgroundColor:Y.palette.background.default},children:[e.jsx(v,{variant:"subtitle2",children:"ONT"}),e.jsx(v,{variant:"h4",color:"primary",children:"1"})]})}),e.jsx(ue,{item:!0,xs:4,children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:1,border:`1px solid ${Y.palette.divider}`,borderRadius:1,backgroundColor:Y.palette.background.default},children:[e.jsx(v,{variant:"subtitle2",children:"IDFs"}),e.jsx(v,{variant:"h4",color:"primary",children:a-1})]})}),e.jsx(ue,{item:!0,xs:4,children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:1,border:`1px solid ${Y.palette.divider}`,borderRadius:1,backgroundColor:Y.palette.background.default},children:[e.jsx(v,{variant:"subtitle2",children:"CONNECTIONS"}),e.jsx(v,{variant:"h4",color:"primary",children:m[a]?Object.values(m[a]).reduce((s,c)=>s+c,0):0})]})})]}):["end_user_device","access_point","ip_phone"].map((s,c)=>{var x;const l=(x=u[t])==null?void 0:x.devices.find(b=>b.type===s);return e.jsx(ue,{item:!0,xs:4,children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:1,border:`1px solid ${Y.palette.divider}`,borderRadius:1,backgroundColor:Y.palette.background.default},children:[e.jsx(v,{variant:"subtitle2",children:s.replace(/_/g," ").toUpperCase()}),e.jsx(v,{variant:"h4",color:"primary",children:l?l.count:0})]})},c)})})}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",gap:2},children:[e.jsx(F,{variant:"contained",color:Re().some(s=>!s.isSatisfied)?"error":"primary",onClick:()=>p(!0),sx:{flex:1,py:1.5,fontWeight:"bold",boxShadow:3,"&:hover":{boxShadow:5}},startIcon:e.jsx(et,{}),children:Re().some(s=>!s.isSatisfied)?"View Issues":"All Satisfied"}),e.jsx(Ae,{title:Re().some(s=>!s.isSatisfied)?"Satisfy all requirements to enable Connection Wizard":"Open Connection Wizard",children:e.jsx("span",{children:e.jsx(Fs,{variant:"contained",onClick:()=>_(!0),disabled:Re().some(s=>!s.isSatisfied),sx:{flex:1,py:1.5,fontWeight:"bold",boxShadow:3,"&:hover":{boxShadow:5}},startIcon:e.jsx(os,{}),children:"Connection Wizard"})})}),e.jsx(F,{variant:"contained",startIcon:e.jsx(ls,{}),sx:{flex:1,py:1.5,fontWeight:"bold",backgroundColor:"#f8bf05",boxShadow:3,"&:hover":{boxShadow:5}},onClick:()=>I(!0),children:"View Patching Schedule"})]})]})]}),e.jsxs(ue,{container:!0,spacing:2,children:[e.jsx(ue,{item:!0,xs:12,md:4,children:e.jsx(g,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:2},className:"rack-visualization",children:e.jsxs($s,{children:[e.jsx(g,{className:"rack-units",children:[...Array(Te)].map((s,c)=>e.jsxs("div",{style:{position:"absolute",top:`${c*20}px`,color:"#fff"},children:[Te-c,"U"]},c))}),e.jsx(g,{className:"rack-container",children:e.jsxs("svg",{ref:je,width:Pe,height:Oe,onDrop:Ct,onDragOver:St,onMouseMove:qt,onMouseUp:_t,children:[e.jsx("rect",{x:"30",y:"0",width:Pe-30,height:Oe,fill:"none",stroke:"#666",strokeWidth:"2"}),[...Array(Te)].map((s,c)=>e.jsx("line",{x1:"30",y1:c*20,x2:Pe,y2:c*20,stroke:"#666",strokeWidth:"1",opacity:"0.5"},c)),L.map(s=>e.jsx(lt,{component:s,rackWidth:Pe,onDelete:Rt,onEdit:It,onDragStart:c=>Pt(c,s),isDragging:H&&H.id===s.id,componentColors:Xe,isHighlighted:pe===s.type,sequence:s.sequence},s.id)),H&&e.jsx("rect",{x:30,y:H.y,width:Pe-40,height:H.units*20,fill:"#FFD700",fillOpacity:.2,stroke:"#FFD700",strokeWidth:2,strokeDasharray:"5,5",rx:"5",ry:"5"}),de&&e.jsx("rect",{x:30,y:de.y,width:Pe-40,height:de.height,fill:"#FFD700",fillOpacity:.2,stroke:"#FFD700",strokeWidth:2,strokeDasharray:"5,5",rx:"5",ry:"5"})]})})]})})}),e.jsxs(ue,{item:!0,xs:12,md:4,children:[e.jsxs(g,{sx:{border:"1px solid #ccc",borderRadius:"4px",p:2,mb:2},children:[e.jsx(v,{variant:"h6",gutterBottom:!0,children:"Legend"}),Object.entries(Xe).map(([s,c])=>{const l=L.filter(x=>x.type===s).length;return e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:.85,justifyContent:"space-between",cursor:"pointer",transition:"all 0.3s ease",border:`3px solid ${c}`,borderRadius:"10px",padding:"1px","&:hover":{transform:"scale(1.023)"}},onMouseEnter:()=>Le(s),onMouseLeave:()=>Le(null),children:[e.jsx(g,{sx:{display:"flex",alignItems:"center",ml:2},children:e.jsxs(v,{children:[s," (",l,")"]})}),e.jsx(g,{sx:{display:"flex",alignItems:"center"},children:e.jsx(g,{sx:{width:30,height:30,mr:1,borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(cs,{fontSize:"small",sx:{color:c}})})})]},s)})]}),e.jsx(ds,{sx:{my:2}}),e.jsxs(g,{sx:{border:"1px solid #ccc",borderRadius:"4px",p:2},children:[e.jsx(v,{variant:"h6",gutterBottom:!0,children:"Infrastructure Layout"}),e.jsxs(g,{sx:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[e.jsx(ps,{sx:{fontSize:40,mb:2,color:Y.palette.info.main}}),e.jsx(g,{sx:{width:"2px",height:"20px",backgroundColor:Y.palette.grey[400]}}),e.jsx(Es,{sx:{mb:2},onClick:()=>C(a),children:"MDF"}),e.jsx(g,{sx:{width:"100%",height:"2px",backgroundColor:Y.palette.grey[400],position:"absolute",top:"50%",left:0,transform:"translateY(-50%)"}}),e.jsxs(g,{sx:{display:"flex",alignItems:"center",width:"100%",mt:4,overflowX:"auto","&::-webkit-scrollbar":{height:"8px"},"&::-webkit-scrollbar-thumb":{backgroundColor:Y.palette.grey[300],borderRadius:"4px"}},children:[a>1&&e.jsx(ce,{onClick:()=>document.getElementById("idf-container").scrollLeft-=100,sx:{flexShrink:0},children:e.jsx(us,{})}),e.jsx(g,{id:"idf-container",sx:{display:"flex",overflowX:"auto",scrollBehavior:"smooth","&::-webkit-scrollbar":{display:"none"},justifyContent:a===1?"center":"flex-start"},children:[...Array(a-1)].map((s,c)=>{var l;return e.jsxs(g,{sx:{display:"flex",flexDirection:"column",alignItems:"center",m:1,flexShrink:0},children:[e.jsx(g,{sx:{width:"2px",height:"20px",backgroundColor:Y.palette.grey[400]}}),e.jsx(g,{sx:{width:"10px",height:"10px",borderRadius:"50%",backgroundColor:Y.palette.grey[400],my:1}}),e.jsxs(As,{onClick:()=>C(c+1),isActive:t===c+1,children:["IDF ",c+1]}),e.jsxs(v,{variant:"caption",sx:{mt:1},children:[(((l=u[c+1])==null?void 0:l.devices)||[]).reduce((x,b)=>x+b.count,0)," device(s)"]})]},c)})}),a>1&&e.jsx(ce,{onClick:()=>document.getElementById("idf-container").scrollLeft+=100,sx:{flexShrink:0},children:e.jsx(hs,{})})]})]})]})]}),e.jsx(ue,{item:!0,xs:12,md:4,children:e.jsxs(we,{elevation:3,sx:{p:2,height:"98.2%"},children:[e.jsx(v,{variant:"h6",gutterBottom:!0,children:"AUTO Panel"}),e.jsx(v,{variant:"body2",sx:{mb:2},children:"Note: This panel's functionality is most accurate when the initial setup form is filled out correctly."}),e.jsx(F,{variant:"contained",fullWidth:!0,sx:{p:2,mb:3,backgroundColor:"#FF9800","&:hover":{backgroundColor:"#f57c00"}},onClick:mt,disabled:L.length>0,children:"Auto Component Placement"}),e.jsx(F,{variant:"contained",fullWidth:!0,sx:{p:2,mb:3,backgroundColor:"#9C27B0","&:hover":{backgroundColor:"#8e24aa"}},onClick:bt,children:"Auto Port Wiring (Patch Panel Setup)"}),e.jsx(F,{variant:"contained",fullWidth:!0,sx:{p:2,mb:3,backgroundColor:"#34c6ea","&:hover":{backgroundColor:"#8e24aa"}},onClick:gt,children:"Auto Component Wiring"}),e.jsx(F,{variant:"contained",fullWidth:!0,sx:{p:4,mb:1,backgroundColor:"#cd3020","&:hover":{backgroundColor:"#d32f2f"}},onClick:vt,children:"Clear IDF"}),e.jsx(v,{variant:"body2",sx:{mt:2,mb:2},children:"Note: Auto placement and wiring functions work best when the IDF is empty. Clear the IDF before using these features for optimal results."}),e.jsx(v,{variant:"subtitle1",gutterBottom:!0,sx:{mt:3,fontWeight:"bold"},children:"Configuration Calculations"}),e.jsxs(g,{sx:{backgroundColor:"#3c3b3b",p:2,borderRadius:2,border:"1px solid #bdbdbd"},children:[e.jsx(v,{variant:"body2",sx:{mb:2,fontStyle:"italic"},children:"These calculations are based on the total number of devices specified in the initial setup."}),e.jsxs(v,{variant:"body2",sx:{mb:1,color:"#000000",backgroundColor:"#dcdcdc",padding:1,borderRadius:5,display:"flex",justifyContent:"space-between"},children:[e.jsx("strong",{style:{paddingLeft:"10px"},children:"Expected Patch Panels:"}),e.jsx("span",{style:{paddingRight:"30px"},children:Math.ceil(O/24)})]}),e.jsxs(v,{variant:"body2",sx:{mb:1,color:"#000000",backgroundColor:"#dcdcdc",padding:1,borderRadius:5,display:"flex",justifyContent:"space-between"},children:[e.jsx("strong",{style:{paddingLeft:"10px"},children:"Expected 48-port Switches:"}),e.jsx("span",{style:{paddingRight:"30px"},children:Math.ceil(O/48)})]}),e.jsxs(v,{variant:"body2",sx:{mb:1,color:"#000000",backgroundColor:"#dcdcdc",padding:1,borderRadius:5,display:"flex",justifyContent:"space-between"},children:[e.jsx("strong",{style:{paddingLeft:"10px"},children:"Expected Fiber Patch Panels:"}),e.jsx("span",{style:{paddingRight:"30px"},children:1})]}),e.jsxs(v,{variant:"body2",sx:{mb:1,color:"#000000",backgroundColor:"#dcdcdc",padding:1,borderRadius:5,display:"flex",justifyContent:"space-between"},children:[e.jsx("strong",{style:{paddingLeft:"10px"},children:"Expected Cable Managers:"}),e.jsx("span",{style:{paddingRight:"30px"},children:Math.ceil(O/24)+1})]}),e.jsxs(v,{variant:"body2",sx:{mt:2,fontStyle:"italic"},children:["Explanation: Patch panels and switches are calculated based on the number of devices, assuming 24 ports per patch panel and 48 ports per switch. One fiber patch panel is included for uplink connections. Cable managers are added to organize cabling between components.",t===a&&" For MDF, one ONT is included for the main internet connection."]})]})]})})]}),e.jsxs(me,{open:V,onClose:()=>X(!1),children:[e.jsx(ge,{children:"Component Details"}),e.jsxs(be,{children:[e.jsx(te,{label:"Name",fullWidth:!0,margin:"normal",id:"component-name"}),J&&(J.type==="switch"||J.type==="patch_panel"||J.type==="fiber_patch_panel"||J.type==="ont")?e.jsx(te,{select:!0,label:"Capacity/Ports",fullWidth:!0,margin:"normal",id:"component-capacity",defaultValue:J.type==="ont"?"1":"24",children:J.type==="switch"?["8","24","48"].map(s=>e.jsx(E,{value:s,children:s},s)):J.type==="fiber_patch_panel"?["12","24"].map(s=>e.jsx(E,{value:s,children:s},s)):J.type==="ont"?["1","2"].map(s=>e.jsx(E,{value:s,children:s},s)):["24"].map(s=>e.jsx(E,{value:s,children:s},s))}):e.jsx(te,{label:"Capacity/Ports",fullWidth:!0,margin:"normal",id:"component-capacity"}),e.jsx(te,{label:"Units (U)",type:"number",fullWidth:!0,margin:"normal",id:"component-units"})]}),e.jsxs(ye,{children:[e.jsx(F,{onClick:()=>X(!1),children:"Cancel"}),e.jsx(F,{onClick:()=>{const s=document.getElementById("component-name").value,c=document.getElementById("component-capacity"),l=c.tagName.toLowerCase()==="div"?c.nextSibling.value:c.value,x=document.getElementById("component-units").value;kt(s,l,x)},children:"Add"})]})]}),e.jsx(dt,{open:K,onClose:Wt,component:ne,idfData:u,currentIdf:t,numIdfs:a,deviceSequence:ne?ne.sequence:void 0}),e.jsx(Rs,{open:k,onClose:()=>p(!1),issues:Re()}),e.jsx(pt,{open:W,onClose:()=>_(!1),components:L,currentIdf:t,onConnectionCreate:yt,onConnectionDelete:jt,existingConnections:S[t]||[]}),e.jsxs(me,{open:De,onClose:()=>I(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(ge,{children:"Patching Schedule"}),e.jsx(be,{children:e.jsx(ot,{connections:S[t]||[],components:L,currentIdf:t})}),e.jsx(ye,{children:e.jsx(F,{onClick:()=>I(!1),children:"Close"})})]}),e.jsxs(me,{open:re,onClose:()=>fe(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(ge,{children:"Recommendations"}),e.jsxs(be,{children:[e.jsx(v,{children:"TODO:"}),e.jsx(v,{children:"Recommendations content will go here."})]}),e.jsx(ye,{children:e.jsx(F,{onClick:()=>fe(!1),children:"Close"})})]})]})};ut.propTypes={currentIdf:o.number.isRequired,setCurrentIdf:o.func.isRequired,numIdfs:o.number.isRequired,idfData:o.object.isRequired,interIdfConnections:o.object.isRequired,onUpdateInterIdfConnections:o.func.isRequired,onPortChange:o.func.isRequired,connectionsPerIdf:o.object.isRequired,onAddConnection:o.func.isRequired,onUpdateConnection:o.func.isRequired,onDeleteConnection:o.func.isRequired,rackDesign:o.array.isRequired,onSaveRackDesign:o.func.isRequired,allComponents:o.object.isRequired,setAllComponents:o.func.isRequired};const ht=({onSubmit:t})=>{const[C,a]=r.useState(1),[u,m]=r.useState({1:{rackSize:42,devices:[]}}),d=[{value:"access_point",label:"Access Point"},{value:"ip_phone",label:"IP Telephone"},{value:"end_user_device",label:"End-User Device"}],$=i=>{const n=Math.max(Math.min(parseInt(i.target.value)||1,10),1);a(n);const h={};for(let y=1;y<=n;y++)h[y]=u[y]||{rackSize:42,devices:[]};m(h)},S=(i,n,h)=>{m(y=>({...y,[i]:{...y[i],[n]:h}}))},z=(i,n,h,y)=>{m(O=>({...O,[i]:{...O[i],devices:O[i].devices.map((N,V)=>V===n?{...N,[h]:y}:N)}}))},B=(i,n)=>{m(h=>({...h,[i]:{...h[i],devices:[...h[i].devices,{type:n,count:1}]}}))},M=(i,n)=>{m(h=>({...h,[i]:{...h[i],devices:h[i].devices.filter((y,O)=>O!==n)}}))},w=i=>{i.preventDefault();const n={...u,[C+1]:{rackSize:42,devices:[{type:"ont",count:1}]}};t({numIdfs:C+1,idfData:n})},G=[18,20,22,24,27,30,32,36,38,42];return e.jsxs(g,{component:"form",onSubmit:w,sx:{width:{xs:"100%",sm:"90%",md:"70%",lg:"50%"},margin:"auto",mt:4,display:"flex",flexDirection:"column",height:"calc(100vh - 100px)"},children:[e.jsxs(we,{elevation:3,sx:{p:3,mb:2},children:[e.jsx(v,{variant:"h5",gutterBottom:!0,children:"Initial Setup"}),e.jsx(te,{fullWidth:!0,margin:"normal",name:"idfs",label:"Number of IDFs (max 10)",type:"number",value:C,onChange:$,required:!0,inputProps:{min:1,max:10}})]}),e.jsx(g,{sx:{flexGrow:1,overflowY:"auto",mt:2,mb:2},children:Object.keys(u).map(i=>e.jsxs(we,{elevation:2,sx:{mb:4,p:2,backgroundColor:"#0f0f0f"},children:[e.jsxs(v,{variant:"h6",gutterBottom:!0,children:["IDF ",i]}),e.jsxs(Ce,{fullWidth:!0,margin:"normal",children:[e.jsx(Se,{children:"Rack Size"}),e.jsx(ke,{value:u[i].rackSize,onChange:n=>S(i,"rackSize",n.target.value),label:"Rack Size",children:G.map(n=>e.jsxs(E,{value:n,children:[n,"U"]},n))})]}),e.jsx(v,{variant:"subtitle1",sx:{mt:2,mb:1},children:"Devices"}),u[i].devices.map((n,h)=>e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(v,{sx:{mr:1,flexGrow:1},children:d.find(y=>y.value===n.type).label}),e.jsx(te,{sx:{mr:1,flexGrow:1},type:"number",label:"Count",value:n.count,onChange:y=>z(i,h,"count",parseInt(y.target.value)||0),inputProps:{min:1}}),e.jsx(F,{onClick:()=>M(i,h),startIcon:e.jsx(xs,{}),children:"Remove"})]},h)),e.jsx(g,{sx:{mt:2},children:d.map(n=>e.jsxs(F,{startIcon:e.jsx(Ne,{}),onClick:()=>B(i,n.value),sx:{mr:1,mb:1},children:["Add ",n.label]},n.value))})]},i))}),e.jsx(we,{elevation:3,sx:{p:2,mt:"auto"},children:e.jsx(F,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,children:"Start Design"})})]})};ht.propTypes={onSubmit:o.func.isRequired};const Ze=(t,C,a)=>{const u=new Date;u.setTime(u.getTime()+a*24*60*60*1e3);const m="expires="+u.toUTCString();document.cookie=t+"="+C+";"+m+";path=/"},xt=t=>{const C=t+"=",u=decodeURIComponent(document.cookie).split(";");for(let m=0;m<u.length;m++){let d=u[m];for(;d.charAt(0)===" ";)d=d.substring(1);if(d.indexOf(C)===0)return d.substring(C.length,d.length)}return""},ft=r.forwardRef(({onSaveWorkspace:t,onLoadWorkspace:C,onNewWorkspace:a,currentWorkspace:u,hasUnsavedChanges:m},d)=>{const $=r.useCallback(()=>{Ze("lastSavedWorkspace",u,1),window.location.reload()},[u]),[S,z]=r.useState(null),[B,M]=r.useState(!1),[w,G]=r.useState(!1),[i,n]=r.useState(""),[h,y]=r.useState([]),[O,N]=r.useState(!1),[V,X]=r.useState(null),[J,se]=r.useState(!1),[ne,Z]=r.useState(!1);r.useState(0);const ie=Me();r.useEffect(()=>{pe();const T=xt("lastSavedWorkspace");T&&(C({name:T}),Ze("lastSavedWorkspace","",-1))},[C]);const ae=T=>{z(T.currentTarget)},H=()=>{z(null)},he=r.useCallback(()=>{a(),H()},[a]),de=r.useCallback(()=>{se(!0),u?t(u).then(()=>{$()}):(M(!0),se(!1)),z(null)},[u,t,m,$]),j=r.useCallback(()=>{G(!0),H()},[]),K=r.useCallback(()=>{se(!0),t(i).then(()=>{se(!1),Z(!0),setTimeout(()=>{Z(!1),M(!1),n(""),pe(),$()},2e3)})},[i,t,$]),Q=r.useCallback(async T=>{if(T&&typeof T=="object")try{const p=JSON.parse(localStorage.getItem("workspaces")||"[]").find(W=>W.name===T.name);p&&p.data?await C(p):console.error("Workspace data not found:",T.name)}catch(k){console.error("Error loading workspace:",k)}else console.error("Invalid workspace object:",T);G(!1)},[C]),xe=r.useCallback(T=>{X(T),N(!0)},[]),oe=r.useCallback(()=>{const T=h.filter(k=>k.name!==V.name);localStorage.setItem("workspaces",JSON.stringify(T)),y(T),N(!1),X(null)},[h,V]),pe=r.useCallback(()=>{const T=JSON.parse(localStorage.getItem("workspaces")||"[]");y(T)},[]);return r.useImperativeHandle(d,()=>({openSaveDialog:()=>{M(!0)}})),e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ae,{title:m?"Save changes":"No unsaved changes",children:e.jsx("span",{children:e.jsx(fs,{in:!0,children:e.jsx(F,{variant:"contained",onClick:de,startIcon:J?e.jsx(nt,{size:20,color:"inherit"}):ne?e.jsx(ms,{}):e.jsx(gs,{}),disabled:J,sx:{backgroundColor:m?"#ca4a4a":"#aad523",color:ie.palette.primary.contrastText,"&:hover":{backgroundColor:m?ie.palette.error.dark:ie.palette.primary.dark},transition:"background-color 0.3s"},children:J?"Saving...":ne?"SAVED!":"Save"})})})}),e.jsx(F,{variant:"contained",onClick:ae,startIcon:e.jsx(Ye,{}),sx:{backgroundColor:"#f8f4f4",color:ie.palette.primary.contrastText,"&:hover":{backgroundColor:ie.palette.primary.dark}},children:"Workspace"}),e.jsxs(bs,{anchorEl:S,open:!!S,onClose:H,PaperProps:{elevation:3,sx:{overflow:"visible",filter:"drop-shadow(0px 2px 8px rgba(0,0,0,0.32))",mt:1.5,"& .MuiAvatar-root":{width:32,height:32,ml:-.5,mr:1},"&:before":{content:'""',display:"block",position:"absolute",top:0,right:14,width:10,height:10,bgcolor:"background.paper",transform:"translateY(-50%) rotate(45deg)",zIndex:0}}},transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[e.jsxs(E,{onClick:he,children:[e.jsx(Ne,{sx:{mr:1}})," New Workspace"]}),e.jsxs(E,{onClick:j,children:[e.jsx(Ye,{sx:{mr:1}})," Load Workspace"]})]}),e.jsxs(me,{open:B,onClose:()=>M(!1),children:[e.jsx(ge,{children:"Save Workspace"}),e.jsx(be,{children:e.jsx(te,{autoFocus:!0,margin:"dense",id:"name",label:"Workspace Name",type:"text",fullWidth:!0,variant:"outlined",value:i,onChange:T=>n(T.target.value)})}),e.jsxs(ye,{children:[e.jsx(F,{onClick:()=>M(!1),children:"Cancel"}),e.jsx(F,{onClick:K,variant:"contained",color:"primary",children:"Save"})]})]}),e.jsxs(me,{open:w,onClose:()=>G(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx(ge,{children:"Load Workspace"}),e.jsxs(be,{children:[e.jsx(Ke,{children:h.map((T,k)=>e.jsx(ys,{in:!0,children:e.jsx(Qe,{secondaryAction:e.jsx(ce,{edge:"end","aria-label":"delete",onClick:()=>xe(T),children:e.jsx(Be,{})}),children:e.jsx(js,{primary:T.name,onClick:()=>Q(T),sx:{cursor:"pointer","&:hover":{backgroundColor:ie.palette.action.hover}}})})},T.name))}),h.length===0&&e.jsx(v,{variant:"body2",sx:{textAlign:"center",mt:2,fontStyle:"italic"},children:"No saved workspaces yet."})]}),e.jsx(ye,{children:e.jsx(F,{onClick:()=>G(!1),children:"Close"})})]}),e.jsxs(me,{open:O,onClose:()=>N(!1),children:[e.jsx(ge,{children:e.jsxs(g,{display:"flex",alignItems:"center",children:[e.jsx(vs,{sx:{color:"warning.main",mr:1}}),"Confirm Deletion"]})}),e.jsx(be,{children:e.jsxs(v,{children:['Are you sure you want to delete the workspace "',V==null?void 0:V.name,'"? This action cannot be undone.']})}),e.jsxs(ye,{children:[e.jsx(F,{onClick:()=>N(!1),children:"Cancel"}),e.jsx(F,{onClick:oe,color:"error",variant:"contained",children:"Delete"})]})]})]})});ft.propTypes={onSaveWorkspace:o.func.isRequired,onLoadWorkspace:o.func.isRequired,onNewWorkspace:o.func.isRequired,currentWorkspace:o.string,hasUnsavedChanges:o.bool.isRequired};const Os=()=>{const[t,C]=r.useState(!1),a=r.useRef(null),[u,m]=r.useState(null),[d,$]=r.useState(1),[S,z]=r.useState([]),[B,M]=r.useState({}),[w,G]=r.useState({}),[i,n]=r.useState({}),[h,y]=r.useState({}),[O,N]=r.useState(null),[V,X]=r.useState(!1),[J,se]=r.useState(!0),ne=r.useRef(null),Z=Cs("(prefers-color-scheme: dark)");r.useEffect(()=>{(async()=>{const p=xt("lastSavedWorkspace");if(p)await de({name:p});else{const W=JSON.parse(localStorage.getItem("workspaces")||"[]");W.length>0&&await de(W[W.length-1])}se(!1)})()},[]);const ie=r.useMemo(()=>Ss({palette:{mode:Z?"dark":"light",primary:{main:Z?"#d2ecff":"#173958"},secondary:{main:Z?"#4b44ed":"#dc004e"},background:{default:Z?"#303030":"#f5f5f5",paper:Z?"#424242":"#ffffff"}},typography:{fontFamily:'"Roboto", "Helvetica", "Arial", sans-serif'},components:{MuiButton:{styleOverrides:{root:{borderRadius:8}}},MuiPaper:{styleOverrides:{root:{borderRadius:12}}}}}),[Z]),ae=k=>{m(k),C(!0);const p={};for(let W=1;W<=k.numIdfs;W++)p[W]=[];y(p),setTimeout(()=>{a.current?a.current.openSaveDialog():console.error("WorkspaceManager ref is not available")},0)},H=r.useCallback(()=>{const k=JSON.stringify({setupComplete:t,networkInfo:u,currentIdf:d,connections:S,connectionsPerIdf:B,rackDesigns:w,interIdfConnections:i,allComponents:h});if(ne.current!==null){const p=k!==ne.current;X(p)}},[t,u,d,S,B,w,i,h]);r.useEffect(()=>{H()},[H]);const he=r.useCallback(k=>new Promise(p=>{const W={setupComplete:t,networkInfo:u,currentIdf:d,connections:S,connectionsPerIdf:B,rackDesigns:w,interIdfConnections:i,allComponents:h},_={name:k||O,data:W},re=JSON.parse(localStorage.getItem("workspaces")||"[]"),fe=re.findIndex(I=>I.name===_.name);fe!==-1?re[fe]=_:re.push(_),localStorage.setItem("workspaces",JSON.stringify(re)),N(_.name);const De=JSON.stringify(W);ne.current=De,X(!1),setTimeout(()=>p(),500)}),[t,u,d,S,B,w,i,h,O]),de=async k=>{if(k&&k.name)try{const W=JSON.parse(localStorage.getItem("workspaces")||"[]").find(_=>_.name===k.name);if(W&&W.data){const{data:_}=W;C(_.setupComplete),m(_.networkInfo),$(_.currentIdf),z(_.connections),M(_.connectionsPerIdf),G(_.rackDesigns),n(_.interIdfConnections),y(_.allComponents),N(k.name);const re=JSON.stringify(_);ne.current=re,X(!1)}else console.error("Workspace data not found:",k.name)}catch(p){console.error("Error loading workspace:",p)}else console.error("Invalid workspace object:",k)},j=()=>{confirm("Are you sure you want to start a new workspace? This will clear all current data.")&&(C(!1),m(null),$(1),z([]),M({}),G({}),n({}),y({}),N(null))},K=r.useCallback(k=>{M(p=>({...p,[d]:[...p[d]||[],k]}))},[d]),Q=r.useCallback(k=>{M(p=>({...p,[d]:p[d].map(W=>W.id===k.id?k:W)}))},[d]),xe=k=>{M(p=>{const W={...p};return typeof k=="number"?W[k]=[]:Object.keys(W).forEach(_=>{W[_]=W[_].filter(re=>re.id!==k)}),W})},oe=r.useCallback((k,p)=>{G(_=>({..._,[k]:p})),y(_=>({..._,[k]:p}));const W=We(p);n(_=>({..._,[k]:W[k]}))},[]),pe=r.useCallback(k=>{n(p=>({...p,...k}))},[]),T=r.useCallback((k,p,W,_,re)=>{y(fe=>{const I=(fe[k]||[]).map(Y=>{if(Y.id===p){const L=[...Y.ports||[]];return L[W]={...L[W],[_]:re},{...Y,ports:L}}return Y}),je=We(I);return n(Y=>({...Y,[k]:je[k]})),{...fe,[k]:I}})},[]);return r.useEffect(()=>{if(u){const k={};for(let p=1;p<=u.numIdfs;p++)k[p]=[];G(k)}},[u]),e.jsxs(ks,{theme:ie,children:[e.jsx(ws,{}),e.jsxs(g,{sx:{display:"flex",flexDirection:"column",height:"100vh"},children:[e.jsx(rt,{children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(v,{variant:"subtitle1",sx:{fontStyle:"italic"},children:O?`Current Workspace: ${O}`:"Unsaved Workspace"}),e.jsx(ft,{ref:a,onSaveWorkspace:he,onLoadWorkspace:de,onNewWorkspace:j,currentWorkspace:O,hasUnsavedChanges:V})]})}),J?e.jsx(g,{sx:{flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(nt,{})}):t?e.jsxs(g,{sx:{display:"flex",flexGrow:1,overflow:"hidden"},children:[e.jsx(g,{sx:{width:250,flexShrink:0},children:e.jsx(at,{currentIdf:d})}),e.jsx(g,{sx:{flexGrow:1,pl:3,overflow:"auto"},children:e.jsx(ut,{currentIdf:d,setCurrentIdf:$,numIdfs:u.numIdfs,idfData:u.idfData,onAddConnection:K,onUpdateConnection:Q,onDeleteConnection:xe,rackDesign:w[d]||[],onSaveRackDesign:k=>oe(d,k),interIdfConnections:i,onUpdateInterIdfConnections:pe,onPortChange:(k,p,W,_)=>T(d,k,p,W,_),connectionsPerIdf:B,allComponents:h,setAllComponents:y})})]}):e.jsx(g,{sx:{flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(ht,{onSubmit:ae})})]})]})};$t.createRoot(document.getElementById("root")).render(e.jsx(Ft.StrictMode,{children:e.jsx(Os,{})}));
